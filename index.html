<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>손안의 가이드</title>
    <link rel="stylesheet" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Maru+Buri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#FDFDFB">
    <style>
        :root {
            --background-color: #FDFDFB;
            --text-primary: #333333;
            --icon-color: #333333;
            --icon-bg: white;
        }
        body { font-family: '나눔 마루부리', serif; background-color: var(--background-color); color: var(--text-primary); }
        .visible { display: flex !important; }
        .glass-ui { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .icon-btn { background-color: var(--icon-bg); color: var(--icon-color); }
        .readable-on-image { text-shadow: 0 1px 10px rgba(0,0,0,0.7); }
        .toast-notification { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: rgba(0,0,0,0.7); color: white; padding: 10px 20px; border-radius: 20px; z-index: 1000; transition: bottom 0.5s ease-in-out; }
        .toast-notification.show { bottom: 30px; }
        .mic-listening { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(255, 255, 255, 0); } }
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .archive-item { position: relative; cursor: pointer; border: 2px solid transparent; transition: border-color 0.2s; }
        .archive-item.selectable:hover { border-color: #a5b4fc; }
        .archive-item.selectable.selected { border-color: #4f46e5; }
        .archive-item.selectable.selected::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(79, 70, 229, 0.2); }
        .selection-checkbox { position: absolute; top: 8px; right: 8px; width: 24px; height: 24px; background-color: rgba(0,0,0,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 10; transform: scale(0); transition: transform 0.2s; }
        .archive-item.selectable.selected .selection-checkbox { transform: scale(1); background-color: #4f46e5; }
    </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.15.0"
  }
}
</script>
</head>
<body class="overflow-hidden">

    <!-- Main Container -->
    <div class="relative w-screen h-screen">

        <!-- Main Page -->
        <main id="mainPage" class="w-full h-full flex-col items-center justify-center hidden">
            <video id="camera-feed" class="absolute inset-0 w-full h-full object-cover" autoplay playsinline></video>
            <div class="absolute inset-0 bg-black/10"></div>
            
            <header class="absolute top-0 left-0 right-0 p-4 text-center z-10">
                <h1 class="text-2xl font-bold text-white readable-on-image">손안의 가이드</h1>
            </header>

            <div id="cameraStartOverlay" class="absolute inset-0 bg-black/50 flex flex-col items-center justify-center text-white z-20 cursor-pointer">
                <div id="startLoader" class="w-12 h-12 border-4 border-white/20 border-t-white rounded-full animate-spin hidden"></div>
                <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                <p class="text-lg font-semibold">터치하여 카메라 시작</p>
                <p class="text-sm mt-1">주변의 사물을 비춰보세요</p>
            </div>

            <footer class="absolute bottom-0 left-0 right-0 p-6 z-10 flex justify-around items-center">
                <button id="uploadBtn" disabled class="icon-btn p-4 rounded-full shadow-lg" aria-label="앨범에서 사진 선택">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                </button>
                <button id="shootBtn" disabled class="w-20 h-20 bg-white rounded-full border-4 border-black/20 shadow-xl" aria-label="사진 촬영"></button>
                <button id="micBtn" disabled class="icon-btn p-4 rounded-full shadow-lg" aria-label="음성으로 질문하기">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>
                </button>
            </footer>
            
            <button id="archiveBtn" class="absolute top-4 right-4 icon-btn p-3 rounded-full shadow-lg z-10" aria-label="보관함 열기">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" /></svg>
            </button>
        </main>

        <!-- Detail Page -->
        <section id="detailPage" class="w-full h-full flex-col items-center justify-center hidden relative">
            <img id="resultImage" src="" alt="Captured image for analysis" class="absolute inset-0 w-full h-full object-cover hidden">
            <div id="loader" class="absolute inset-0 bg-black/50 flex flex-col items-center justify-center text-white z-20 hidden">
                <div class="w-12 h-12 border-4 border-white/20 border-t-white rounded-full animate-spin"></div>
                <p id="loadingText" class="mt-4 text-lg">분석 중...</p>
            </div>
            
            <div id="textOverlay" class="absolute inset-0 p-6 pt-20 pb-28 text-white overflow-y-auto z-10 hidden">
                <div id="loadingHeader" class="text-center mb-6 hidden">
                    <h1 class="text-2xl font-bold">로딩 중...</h1>
                </div>
                <p id="descriptionText" class="text-xl leading-relaxed whitespace-pre-wrap readable-on-image"></p>
            </div>

            <header class="absolute top-0 left-0 right-0 p-4 flex justify-between items-center z-20">
                <button id="backBtn" class="icon-btn p-3 rounded-full shadow-lg" aria-label="뒤로 가기">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>
                </button>
            </header>

            <footer id="detailFooter" class="absolute bottom-0 left-0 right-0 p-6 z-20 flex justify-around items-center hidden">
                <button id="audioBtn" class="icon-btn p-4 rounded-full shadow-lg" aria-label="오디오 재생"></button>
                <button id="textToggleBtn" class="icon-btn p-4 rounded-full shadow-lg" aria-label="해설 숨기기">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>
                </button>
                <button id="saveBtn" class="icon-btn p-4 rounded-full shadow-lg" aria-label="보관함에 저장"></button>
            </footer>
        </section>

        <!-- Archive Page -->
        <section id="archivePage" class="w-full h-full flex flex-col bg-white hidden">
            <header id="archiveHeader" class="p-4 flex justify-between items-center border-b z-10 sticky top-0 bg-white">
                <button id="archiveBackBtn" class="p-2" aria-label="뒤로 가기">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>
                </button>
                <h2 class="text-xl font-bold">보관함</h2>
                <button id="selectArchiveBtn" class="p-2 text-blue-600 font-semibold hidden">선택</button>
            </header>
            <header id="selectionHeader" class="p-4 flex justify-between items-center border-b z-10 hidden sticky top-0 bg-white">
                <button id="cancelSelectionBtn" class="p-2 text-blue-600 font-semibold">취소</button>
                <h2 id="selectionCount" class="text-xl font-bold">0개 선택</h2>
                <button id="deleteSelectedBtn" class="p-2 text-red-600 font-semibold" disabled>삭제</button>
            </header>
            <div class="flex-grow overflow-y-auto p-2">
                <div id="emptyArchiveMessage" class="text-center pt-20 text-gray-500 hidden">
                    <p>보관된 항목이 없습니다.</p>
                </div>
                <div id="archiveGrid" class="grid grid-cols-3 gap-1"></div>
            </div>
        </section>
        
        <canvas id="capture-canvas" class="hidden"></canvas>
        <input type="file" id="upload-input" accept="image/*" class="hidden">
    </div>

    <div id="toastContainer" class="fixed bottom-0 left-0 right-0 p-4 flex flex-col items-center z-50 pointer-events-none"></div>

    <script type="module" src="index.js" defer></script>
</body>
</html>